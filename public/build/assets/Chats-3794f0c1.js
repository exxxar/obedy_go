import{r as V,o as s,c as D,w as S,a as e,b as _,d as t,e as m,n as p,F as u,_ as H,u as P,s as $,f as J,g as K,h as E,i as Q,j as U,k as X,l as M,v as A,m as r,p as Y,t as h,q as g,x as B,y as N,z as Z,A as ee}from"./app-c0392840.js";import{_ as se}from"./PageTitle-4f959a5e.js";const te={class:"modal-header border-0"},ae=e("h5",{class:"modal-title"},null,-1),oe={id:"galleryCarouselIndicators",class:"carousel slide h-100"},ne={class:"carousel-indicators"},le=["data-bs-slide-to","aria-label"],ie={class:"carousel-inner h-100"},ce=["src"],re={class:"carousel-control-prev",type:"button","data-bs-target":"#galleryCarouselIndicators","data-bs-slide":"prev"},de=e("span",{class:"visually-hidden"},"Previous",-1),ue={class:"carousel-control-next",type:"button","data-bs-target":"#galleryCarouselIndicators","data-bs-slide":"next"},_e=e("span",{class:"visually-hidden"},"Next",-1),he={__name:"GalleryModal",props:{images:{type:Array,default:[]},active:{type:Number,default:0}},setup(b){return(f,j)=>{const n=V("font-awesome-icon");return s(),D(H,{id:"gallery",class_size:"modal-dialog-centered modal-fullscreen",class_content:"bg-transparent",header:!1,title:""},{header:S(()=>[e("div",te,[ae,_(n,{class:"text-white px-3 cursor-pointer","data-bs-dismiss":"modal",icon:"fa-solid fa-xmark",size:"2xl"})])]),body:S(()=>[e("div",oe,[e("div",ne,[(s(!0),t(u,null,m(b.images,(y,v)=>(s(),t("button",{type:"button","data-bs-target":"#galleryCarouselIndicators","data-bs-slide-to":v,class:p(v===b.active?"active":""),"aria-current":"true","aria-label":"Slide "+v},null,10,le))),256))]),e("div",ie,[(s(!0),t(u,null,m(b.images,(y,v)=>(s(),t("div",{class:p(["carousel-item h-100",v===b.active?"active":""])},[e("img",{src:y,class:"d-block w-100 h-100 object-fit-contain",alt:"..."},null,8,ce)],2))),256))]),e("button",re,[_(n,{class:"cursor-pointer","aria-hidden":"true",icon:"fa-solid fa-chevron-left",size:"2xl"}),de]),e("button",ue,[_(n,{class:"cursor-pointer","aria-hidden":"true",icon:"fa-solid fa-chevron-right",size:"2xl"}),_e])])]),_:1})}}},ge={class:"container p-0 z-10"},fe={class:"w-100 row m-0 d-flex flex-wrap justify-content-center mb-5"},me={class:"col-md-5 col-lg-4 col-12 chat"},pe={class:"card mb-sm-3 mb-md-0 contacts_card"},ve={class:"card-header"},ye={class:"input-group"},be={class:"card-body contacts_body"},xe={class:"contacts"},ke=["onClick"],we={class:"d-flex cursor-pointer bd-highlight"},Ce={class:"img_cont"},Me=["src"],je={class:"user_info text-truncate"},ze={key:0,class:"text-truncate"},Ie={key:1,class:"d-flex gap-2 align-items-center"},Se={class:"text-truncate"},$e={key:0},Ee={key:0},Ue={key:1},Ae={key:1,class:"message-counter d-flex justify-content-center align-items-center"},Be={class:"text-white"},Ne=e("div",{class:"card-footer"},null,-1),Ve={class:"col-md-7 col-lg-8 col-12 chat"},De={class:"card-header msg_head"},Fe={class:"d-flex bd-highlight"},Le={class:"img_cont"},Te=["src"],Oe={class:"user_info"},Re=["id"],Ge={class:"img_cont_msg"},We={class:"d-flex flex-column justify-content-center align-items-center rounded-circle bg-danger h-100 fw-bold"},qe={class:"text-white lh-1",style:{"font-size":"12px"}},He={class:"d-flex flex-column"},Pe={class:"d-flex justify-content-center mb-3"},Je={class:"img_cont_msg"},Ke=["src"],Qe=["id"],Xe={key:0,class:"d-flex flex-wrap gap-1 justify-content-center"},Ye={class:"col-auto"},Ze=["onClick"],es={key:1,class:"col-12 d-flex flex-wrap gap-2"},ss={class:"col-auto overflow-hidden file-link-container"},ts=["href"],as={key:1},os={key:0},ns={key:1},ls={key:1,class:"text-center"},is={class:"card-footer"},cs={class:"input-group"},rs={class:"input-group-text attach_btn",for:"actual-btn"},ds=["disabled"],us={key:0,class:"d-flex flex-column fixed-height-min-max-125px"},_s={class:"list-group overflow-x-hidden bg-white"},hs={class:"list-group-item d-flex justify-content-between align-items-center bg-white px-4"},gs=["id"],fs=["onClick"],ms={key:1,class:"text-center"},bs={__name:"Chats",setup(b){const f=P(),{filterChats:j,currentChat:n,searchString:y}=$(f),v=J(),{user:z}=$(v),I=()=>({message:"",files:[]}),d=K(I()),w=E([]),C=E(0);Q(()=>{f.getChats(),route().params.chatId!==void 0&&f.getChat(route().params.chatId),z.value.isAuthorized&&Echo.private("chat."+z.value.id).listenToAll((o,l)=>{switch(o){case"SeenMessageEvent":{f.makeSeenMessage(l.chatId,l.messageId);break}case"SeenAllMessagesEvent":{f.updateChat(l.chatId);break}}}),document.getElementById("chatSearch").addEventListener("click",o=>{o.target.setAttribute("type","text")},{once:!0})});const F=U(()=>n.value.data===null?[]:new Set(n.value.data.messages.map(o=>o.date))),L=o=>n.value.data.messages.filter(l=>l.date===o),T=async()=>{await f.sendMessage(d).then(o=>{Object.assign(d,I())})},O=async o=>{if(o.target.files.length>0)if(o.target.files.length+d.files.length<=10){let l=0;Array.prototype.slice.call(d.files).concat(Array.prototype.slice.call(o.target.files)).forEach(c=>{/(image\/)/g.test(c.type)&&(l+=1)}),l<=9?Object.entries(o.target.files).forEach(([c,x])=>{d.files.push(x),B(()=>{document.getElementById("messageFile-"+c).setAttribute("href",window.URL.createObjectURL(x))})}):N("Максимальное количество прикреплённых изображений - 9!","error")}else N("Максимальное количество прикреплённых файлов - 10! Вы ещё можете прикрепить "+(10-d.files.length),"error");o.target.value=""},R=async(o,l)=>{w.value=o,C.value=l,await B(()=>{let c=document.getElementById("gallery");ee.getOrCreateInstance(c).show(),c.addEventListener("hidden.bs.modal",x=>{w.value=[],C.value=0},{once:!0})})},G=o=>{let l=document.getElementById("current-chat-body-"+o);l.scroll({top:l.scrollHeight,behavior:"smooth"}),n.value.data.unseenMessageCount=0},W=U(()=>{let o=document.getElementById("current-chat-body-"+n.value.data.id);return o!==null&&o.offsetWidth>o.clientWidth});return(o,l)=>{const c=V("font-awesome-icon"),x=X("lazy");return s(),t(u,null,[_(se,{title:"Чаты"}),e("div",ge,[e("div",fe,[e("div",me,[e("div",pe,[e("div",ve,[e("div",ye,[M(e("input",{type:"password",placeholder:"Поиск...",autocomplete:"off",readonly:"",onfocus:"this.removeAttribute('readonly')",name:"chatSearch",id:"chatSearch",class:"form-control chat-search","onUpdate:modelValue":l[0]||(l[0]=a=>Y(y)?y.value=a:null)},null,512),[[A,r(y)]])])]),e("div",be,[e("ul",xe,[(s(!0),t(u,null,m(r(j),a=>(s(),t("li",{class:"active",onClick:i=>r(f).getChat(a.id)},[e("div",we,[e("div",Ce,[e("img",{src:a.interlocutor.image,class:"rounded-circle object-fit-cover user_img"},null,8,Me)]),e("div",je,[e("span",null,h(a.interlocutor.name),1),a.lastMessage===null?(s(),t("p",ze,"В чате пока нет сообщений")):(s(),t("div",Ie,[e("p",Se,[a.lastMessage.isUserMessage?(s(),t("strong",$e,"Вы: ")):g("",!0),Z(" "+h(a.lastMessage.message===null?"Вложения":a.lastMessage.message),1)]),a.lastMessage.isUserMessage?(s(),t(u,{key:0},[a.lastMessage.isSeen?(s(),t("p",Ue,[_(c,{icon:"fa-solid fa-check-double",size:"lg"})])):(s(),t("p",Ee,[_(c,{icon:"fa-solid fa-check",size:"lg"})]))],64)):g("",!0),a.unseenMessageCount>0&&!a.lastMessage.isUserMessage?(s(),t("div",Ae,[e("p",Be,h(a.unseenMessageCount),1)])):g("",!0)]))])])],8,ke))),256))])]),Ne])]),e("div",Ve,[e("div",{class:p(["card overflow-auto",r(n).data!==null?"":"justify-content-center"])},[r(n).data!==null?(s(),t(u,{key:0},[e("div",De,[e("div",Fe,[e("div",Le,[e("img",{src:r(n).data.interlocutor.image,class:"rounded-circle object-fit-cover user_img"},null,8,Te)]),e("div",Oe,[e("span",null,h(r(n).data.interlocutor.name),1),e("p",null,h(r(n).data.messageCount)+" сообщений",1)])])]),e("div",{class:p(["card-body msg_card_body",r(n).data.messages.length>0?"":"d-flex flex-column justify-content-center"]),id:"current-chat-body-"+r(n).data.id},[r(n).data.messages.length>0?(s(),t(u,{key:0},[r(n).data.unseenMessageCount>0&&W.value?(s(),t("div",{key:0,class:"cursor-pointer position-absolute bottom-0 end-0 z-10",style:{transform:"translate(-50%, -200%)"},onClick:l[1]||(l[1]=a=>G(r(n).data.id))},[e("div",Ge,[e("div",We,[e("p",qe,h(r(n).data.unseenMessageCount),1),_(c,{class:"text-white",icon:"fa-solid fa-chevron-down",beat:"",size:"lg"})])])])):g("",!0),(s(!0),t(u,null,m(F.value,a=>(s(),t("div",He,[e("div",Pe,h(a),1),(s(!0),t(u,null,m(L(a),i=>(s(),t("div",{class:p(["d-flex justify-content-start mb-4",i.isUserMessage?"flex-row-reverse":""])},[e("div",Je,[e("img",{src:i.isUserMessage?r(n).data.user.image:r(n).data.interlocutor.image,class:"rounded-circle object-fit-cover user_img_msg"},null,8,Ke)]),e("div",{id:"message-"+i.id,class:p(i.isUserMessage?"msg_container_send":"msg_container")},[i.files.length>0||i.images.length>0?(s(),t("div",{key:0,class:p(["file-container d-flex flex-wrap gap-2 justify-content-center",i.message!==null?"mb-2":""])},[i.images.length>0?(s(),t("div",Xe,[(s(!0),t(u,null,m(i.images,(k,q)=>(s(),t("div",Ye,[M(e("img",{onClick:ps=>R(i.images,q),class:"cursor-pointer img-fluid rounded image-container"},null,8,Ze),[[x,k]])]))),256))])):g("",!0),i.files.length>0?(s(),t("div",es,[(s(!0),t(u,null,m(i.files,k=>(s(),t("div",ss,[e("a",{class:"d-flex gap-2 align-items-center text-break justify-content-between link",href:k.path,target:"_blank"},[e("p",null,h(k.name),1),_(c,{icon:"fa-solid fa-download"})],8,ts)]))),256))])):g("",!0)],2)):g("",!0),i.message!==null?(s(),t("p",as,h(i.message),1)):g("",!0),e("div",{class:p(["d-flex gap-2",i.isUserMessage?"msg_time_send":"msg_time"])},[e("span",null,h(i.time),1),i.isUserMessage?(s(),t(u,{key:0},[i.isSeen?(s(),t("span",ns,[_(c,{icon:"fa-solid fa-check-double",size:"lg"})])):(s(),t("span",os,[_(c,{icon:"fa-solid fa-check",size:"lg"})]))],64)):g("",!0)],2)],10,Qe)],2))),256))]))),256))],64)):(s(),t("p",ls,"В чате пока нет сообщений"))],10,Re),e("div",is,[e("div",cs,[e("input",{type:"file",id:"actual-btn",onChange:l[2]||(l[2]=a=>O(a)),multiple:"",hidden:""},null,32),e("label",rs,[_(c,{icon:"fa-solid fa-paperclip"})]),M(e("textarea",{name:"message",class:"form-control type_msg","onUpdate:modelValue":l[3]||(l[3]=a=>d.message=a),placeholder:"Напишите ваше сообщение..."},null,512),[[A,d.message]]),e("button",{class:"input-group-text send_btn",onClick:T,disabled:d.message===null&&d.files.length===0},[_(c,{icon:"fa-solid fa-location-arrow"})],8,ds)])]),d.files.length>0?(s(),t("div",us,[e("ul",_s,[(s(!0),t(u,null,m(d.files,(a,i)=>(s(),t("li",hs,[e("a",{id:"messageFile-"+i,href:"#",target:"_blank"},h(a.name),9,gs),e("span",{onClick:k=>d.files.splice(i,1)},[_(c,{class:"cursor-pointer",icon:"fa-solid fa-location-arrow",size:"lg"})],8,fs)]))),256))])])):g("",!0)],64)):(s(),t("p",ms,"Выберите кому хотели бы написать"))],2)])])]),w.value.length>0?(s(),D(he,{key:0,images:w.value,active:C.value},null,8,["images","active"])):g("",!0)],64)}}};export{bs as default};
