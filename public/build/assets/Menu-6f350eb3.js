import{j as F,r as U,o as d,d as m,a as o,b as i,q as P,n as O,F as $,e as I,t as V,y as T,c as N,w as C,z as j,m as y,G as b,H as E,I as B,_ as z,A as R,B as A,g as L,h as H,i as q,J as D,x as G}from"./app-0044d8d2.js";import{_ as J}from"./PageTitle-14d59ea4.js";const W={class:"input-group"},K=o("span",null,"Выбрать изображение",-1),Q={class:"col-lg-3 col-md-6 col-sm-6 col-12"},X=["src"],Y={class:"col-sm-auto col-12"},Z={class:"invalid-feedback"},S={__name:"ImageInput",props:{image:{default:null},error:{type:Boolean,default:!0},errors:{type:Array,default:[]}},emits:["update:image"],setup(e,{emit:f}){const w=e,x=u=>{let t=u.target;t.localName==="div"?t.nextElementSibling.firstChild.click():(t.localName==="svg"||t.localName==="path"||t.localName==="span")&&t.closest("div").nextElementSibling.firstChild.click()},s=u=>{let t=u.target.files;t.length&&(t[0]&&t[0].type.includes("image")?(u.target.nextElementSibling.firstChild.src=URL.createObjectURL(t[0]),f("update:image",t[0])):(T("Произошла ошибка! Файл не является изображением!","error"),u.target.value=null))},r=u=>{f("update:image",null),u.target.closest("div").previousElementSibling.firstChild.src=null,u.target.closest("div").previousElementSibling.previousElementSibling.value=null},l=F(()=>typeof w.image=="string"?w.image:URL.createObjectURL(w.image));return(u,t)=>{const p=U("font-awesome-icon");return d(),m("div",W,[o("div",{class:"col-sm-auto col-12 input-group-text flex-wrap justify-content-center gap-2 cursor-pointer px-4 py-3",onClick:x},[i(p,{icon:"fa-solid fa-image"}),K]),o("div",{class:O(["form-control col-sm col-12 px-4 py-3 d-flex flex-wrap align-items-center text-center gap-3",[e.errors.length>0?"is-invalid":"",e.errors.length===0&&e.image!==""&&e.image!==null?"is-valid":""]])},[o("input",{class:"d-none",accept:"image/*",type:"file",onChange:s},null,32),o("div",Q,[e.image!==null&&e.image!==""?(d(),m("img",{key:0,class:"img-fluid",alt:"",src:l.value},null,8,X)):P("",!0)]),o("div",Y,[e.image!==null&&e.image!==""?(d(),m("button",{key:0,class:"col-auto btn btn-danger",onClick:r},[i(p,{icon:"fa-solid fa-trash"})])):P("",!0)])],2),e.errors.length>0&&e.error?(d(!0),m($,{key:0},I(e.errors,k=>(d(),m("div",Z,V(k),1))),256)):P("",!0)])}}},_={class:"d-flex align-items-center"},ee={class:"badge bg-danger ms-2"},te={class:"w-100 d-flex flex-column gap-3"},oe={class:"input-group-text justify-content-center w-auto"},se={class:"w-100 d-flex flex-column gap-3"},le={class:"d-flex gap-3 flex-column border rounded px-4 py-3"},re={class:"d-flex gap-3"},ne={class:"input-group-text justify-content-center w-auto"},ce=["onClick"],ie={key:1,class:"col d-flex flex-column align-self-center"},ae={class:"invalid-feedback"},de={class:"col d-flex align-self-center"},ue={__name:"MenuProductModal",props:{product:{type:Object,default:{}},productErrors:{type:Object,default:{}},selectProduct:{type:Object,default:{}}},emits:["update:product"],setup(e,{emit:f}){const w=e,x=(r=null)=>{const{product:l}=w;r!==null?l.positions.push({title:"",weight:""}):l.positions.splice(r,1),f("update:product",l)},s=()=>{R.getOrCreateInstance(document.getElementById("menuProductModal")).hide()};return(r,l)=>{const u=U("font-awesome-icon");return d(),N(z,{id:"menuProductModal",class_size:"modal-lg"},{title:C(()=>[o("h3",_,[j(V(e.selectProduct.isEdit?"Редактировать ":"Создать ")+" товар ",1),o("span",ee,V(e.product.title),1)])]),body:C(()=>[o("div",te,[i(E,{errors:y(b).call(e.productErrors,"products."+e.selectProduct.id+".price")?e.productErrors["products."+e.selectProduct.id+".price"]:[],placeholder:"Цена",modelValue:e.product.price,"onUpdate:modelValue":l[0]||(l[0]=t=>e.product.price=t),groupTextIconRight:"fa-solid fa-ruble-sign","keyup-only-number":!0},null,8,["errors","modelValue"]),i(E,{errors:y(b).call(e.productErrors,"products."+e.selectProduct.id+".weight")?e.productErrors["products."+e.selectProduct.id+".weight"]:[],placeholder:"Вес",modelValue:e.product.weight,"onUpdate:modelValue":l[1]||(l[1]=t=>e.product.weight=t),"keyup-only-number":!0},{groupTextIconRight:C(()=>[o("span",oe,[j(" гр. "),i(u,{class:"ms-1",icon:"fa-solid fa-scale-unbalanced-flip"})])]),_:1},8,["errors","modelValue"]),i(S,{errors:y(b).call(e.productErrors,"products."+e.selectProduct.id+".image")?e.productErrors["products."+e.selectProduct.id+".image"]:[],image:e.product.image,"onUpdate:image":l[2]||(l[2]=t=>e.product.image=t)},null,8,["errors","image"]),i(B,{errors:y(b).call(e.productErrors,"description")?r.errors.description:[],placeholder:"Описание",modelValue:e.product.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.product.description=t),groupTextIconLeft:"fa-solid fa-utensils"},null,8,["errors","modelValue"]),o("div",se,[e.product.positions.length>0?(d(!0),m($,{key:0},I(e.product.positions,(t,p)=>(d(),m("div",le,[i(E,{errors:y(b).call(e.productErrors,"products."+e.selectProduct.id+".positions."+p+".title")?e.productErrors["products."+e.selectProduct.id+".positions."+p+".title"]:[],placeholder:"Название",modelValue:t.title,"onUpdate:modelValue":k=>t.title=k,groupTextIconLeft:"fa-solid fa-heading"},null,8,["errors","modelValue","onUpdate:modelValue"]),o("div",re,[i(E,{errors:e.productErrors.hasOwnProperty("products."+e.selectProduct.id+".positions."+p+".weight")?e.productErrors["products."+e.selectProduct.id+".positions."+p+".weight"]:[],placeholder:"Вес",modelValue:t.weight,"onUpdate:modelValue":k=>t.weight=k,"keyup-only-number":!0},{groupTextIconRight:C(()=>[o("span",ne,[j(" гр. "),i(u,{class:"ms-1",icon:"fa-solid fa-scale-unbalanced-flip"})])]),_:2},1032,["errors","modelValue","onUpdate:modelValue"]),o("div",{class:O(["d-flex gap-2",[e.productErrors.hasOwnProperty("products."+e.selectProduct.id+".positions."+p+".weight")&&e.productErrors["products."+e.selectProduct.id+".positions."+p+".weight"].length>0?"align-items-start":"align-items-center"]])},[e.product.positions.length-1===p?(d(),m("button",{key:0,class:"btn btn-success",type:"button",onClick:x},[i(u,{icon:"fa-solid fa-plus"})])):P("",!0),o("button",{class:"btn btn-danger",type:"button",onClick:k=>x(p)},[i(u,{icon:"fa-solid fa-trash"})],8,ce)],2)])]))),256)):(d(),m("div",ie,[o("button",{class:O(["btn btn-success",[e.productErrors.hasOwnProperty("products."+e.selectProduct.id+".positions")&&e.productErrors["products."+e.selectProduct.id+".positions"].length>0?"is-invalid":""]]),type:"button",onClick:x}," Добавить ингредиент ",2),e.productErrors.hasOwnProperty("products."+e.selectProduct.id+".positions")&&e.productErrors["products."+e.selectProduct.id+".positions"].length>0?(d(!0),m($,{key:0},I(e.productErrors["products."+e.selectProduct.id+".positions"],t=>(d(),m("div",ae,V(t),1))),256)):P("",!0)])),o("div",de,[o("button",{class:"btn btn-success",type:"button",onClick:l[4]||(l[4]=t=>s())}," Продолжить ")])])])]),_:1})}}};const me={class:"container tab-content z-10"},pe={class:"row justify-content-center"},ge={class:"col"},fe={class:"card"},he={class:"card-body d-flex flex-column gap-3 align-items-center"},ye={class:"w-100 d-flex flex-column gap-3"},be={class:"w-100 list-group"},ve={class:"list-group-item px-2 py-2"},we={class:"w-100 d-flex align-items-center justify-content-between"},xe={key:0,class:"m-0"},ke=["onClick"],Pe=["onClick"],Ee={class:"d-flex gap-3"},Ve={class:"d-flex justify-content-center"},$e={__name:"Menu",props:{menu:{type:Object,default:{}}},setup(e){const f=e,w=()=>({title:"",image:"",description:"",price:"",products:[]}),x=()=>({image:"",title:"",description:"",positions:[],price:"",weight:""}),s=L(w()),r=H([]),l=L({id:null,isEdit:null}),u=["Понедельник","Вторник","Среда","Четверг","Пятница"];q(()=>{t()});const t=()=>{u.forEach((g,n)=>{if(route().current("menu.create"))s.products.push(x()),s.products[n].title=g;else if(route().current("menu.edit")){let h=f.menu.products.findIndex(c=>c.day_index===n+1);h===-1?(s.products.push(x()),s.products[n].title=g):s.products.push(f.menu.products[h])}}),route().current("menu.edit")&&(s.id=f.menu.id,s.title=f.menu.title,s.image=f.menu.image,s.description=f.menu.description,s.price=f.menu.price)},p=async(g,n)=>{l.id=n,l.isEdit=g,await G(()=>{let h=document.getElementById("menuProductModal");R.getOrCreateInstance(h).show(),h.addEventListener("hidden.bs.modal",c=>{l.id=null,l.isEdit=null},{once:!0})})},k=()=>{axios.post(route("menu.store"),M(s),{headers:{"Content-Type":"multipart/form-data"}}).then(g=>{T("Ваше меню было успешно сохранено!"),r.value=[],route().current("menu.create")&&(Object.assign(s,w()),t())}).catch(g=>{g.response.status===422&&(r.value=g.response.data.errors)})},M=(g,n=new FormData,h="")=>{for(let c in g){let a=g[c],v=h?h+"["+c+"]":c;(typeof a=="string"||typeof a=="number")&&c!=="image"||c==="image"&&(a instanceof File||a===null||a.length===0)?n.append(v,a):typeof a=="object"&&M(a,n,v)}return n};return(g,n)=>{const h=U("font-awesome-icon");return d(),m($,null,[i(J,{title:g.route().current("menu.edit")?"Редактирование меню":"Создание меню"},null,8,["title"]),o("div",me,[o("div",pe,[o("div",ge,[o("div",fe,[o("div",he,[o("div",ye,[i(E,{errors:y(b).call(r.value,"title")?r.value.title:[],placeholder:"Название",modelValue:s.title,"onUpdate:modelValue":n[0]||(n[0]=c=>s.title=c),groupTextIconLeft:"fa-solid fa-heading"},null,8,["errors","modelValue"]),i(B,{errors:y(b).call(r.value,"description")?r.value.description:[],placeholder:"Описание",modelValue:s.description,"onUpdate:modelValue":n[1]||(n[1]=c=>s.description=c),textareaName:"description",groupTextIconLeft:"fa-solid fa-utensils"},null,8,["errors","modelValue"]),i(E,{errors:y(b).call(r.value,"price")?r.value.price:[],placeholder:"Цена",modelValue:s.price,"onUpdate:modelValue":n[2]||(n[2]=c=>s.price=c),"keyup-only-number":!0,groupTextIconRight:"fa-solid fa-ruble-sign"},null,8,["errors","modelValue"]),i(S,{errors:y(b).call(r.value,"image")?r.value.image:[],image:s.image,"onUpdate:image":n[3]||(n[3]=c=>s.image=c)},null,8,["errors","image"]),o("div",be,[(d(),m($,null,I(u,(c,a)=>o("div",ve,[o("div",{class:O(["d-flex flex-column px-3 py-2 gap-3",[Object.keys(r.value).filter(v=>v.toLowerCase().indexOf(("products."+a).toLowerCase())!==-1).length>0?"border rounded div-invalid":"",Object.keys(r.value).length>0&&Object.keys(r.value).filter(v=>v.toLowerCase().indexOf(("products."+a).toLowerCase())!==-1).length===0?"border rounded div-valid":""]])},[o("div",we,[s.products[a]?(d(),m("h5",xe,V(s.products[a].title),1)):P("",!0),s.products[a]&&!y(b).call(s.products[a],"day_index")?(d(),m("button",{key:1,class:"btn btn-success",type:"button",onClick:v=>p(!1,a)},[i(h,{icon:"fa-solid fa-plus"})],8,ke)):(d(),m("button",{key:2,class:"btn btn-warning",type:"button",onClick:v=>p(!0,a)},[i(h,{icon:"fa-solid fa-pencil"})],8,Pe))]),o("div",Ee,[i(D,{product:s.products[a],"add-menu":!0},null,8,["product"])])],2)])),64))])]),o("div",Ve,[o("button",{class:"btn btn-success",type:"button",onClick:n[4]||(n[4]=c=>k())},V(g.route().current("menu.edit")?"Обновить меню":"Сохранить меню"),1)])])])])])]),l.id!==null?(d(),N(ue,{key:0,"select-product":l,"product-errors":Object.fromEntries(Object.entries(r.value).filter(([c])=>c.startsWith("products."+l.id))),product:s.products[l.id]},null,8,["select-product","product-errors","product"])):P("",!0)],64)}}},Ie=A($e,[["__scopeId","data-v-28406210"]]);export{Ie as default};
