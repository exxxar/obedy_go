import{_ as U}from"./PageTitle-5c0dafb3.js";import{M as B,h as v,f as O,N as A,O as k,y,B as M,s as D,i as F,r as L,o as i,d as b,b as f,a as s,m as e,H as h,I as P,P as H,c as w,J as z,q as x,w as S,z as R,Q as j,F as C,e as q,_ as G,x as J,C as Q,D as K}from"./app-5d7ca779.js";import{_ as T}from"./MenuCard-032eaacf.js";const W=B("profileStore",()=>{const d=v({}),n=v({}),t=v([]),r=v(File|null),c=O();A(()=>c.user.addresses,(l,_)=>{l&&(n.value.addresses=l)});async function I(){await k.get(route("profile.get")).then(l=>{n.value=l.data.profile,t.value=l.data.menus}).catch(l=>{})}async function u(){await k.put(route("profile.update"),n.value).then(l=>(d.value={},y("Профиль успешно обновлён!","success"),Promise.resolve(l))).catch(l=>{l.response.status===422&&(d.value=l.response.data.errors,y("Произошла ошибка!","error"))})}async function p(){let l=new FormData;l.append("image",r.value),await k.post(route("profile.avatar"),l,{headers:{"Content-Type":"multipart/form-data"}}).then(_=>(y("Аватар успешно обновлён!","success"),n.value.image=_.data.avatar,r.value=null,fetch(n.value.image,{cache:"reload",mode:"no-cors"}),document.getElementById("imgProfileImage").src=n.value.image,Promise.resolve(_))).catch(_=>{_.response.status===422&&(y("Произошла ошибка!","error"),r.value=null)})}return{profile:n,menus:t,errors:d,uploadImage:r,getProfile:I,updateProfile:u,updateProfileAvatar:p}});const N=d=>(Q("data-v-4dc1b60c"),d=d(),K(),d),X={class:"container tab-content pb-3 z-10"},Y={class:"row justify-content-center mt-4"},Z={class:"col mt-5"},ee={class:"profile-card card position-relative mt-5 p-3 pt-5"},oe={class:"profile-card__img"},se=["src"],ae=N(()=>s("i",{class:"fa-solid fa-camera fa-xl"},null,-1)),te=[ae],le={class:"accordion w-100 d-flex flex-column mt-5",id:"accordionExample"},re={class:"accordion-item"},ne=N(()=>s("h2",{class:"accordion-header"},[s("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"true","aria-controls":"collapseOne"}," Данные профиля ")],-1)),ie={id:"collapseOne",class:"accordion-collapse collapse show","data-bs-parent":"#accordionExample"},de={class:"accordion-body d-flex flex-column gap-3 align-items-center"},ce={class:"w-100 d-flex flex-column gap-3"},ue={key:0,class:"accordion-item"},pe={class:"accordion-header"},me={class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseTwo","aria-expanded":"false","aria-controls":"collapseTwo"},fe={id:"collapseTwo",class:"accordion-collapse collapse show","data-bs-parent":"#accordionExample"},_e={class:"accordion-body d-flex gap-3 align-items-center"},ve={class:"col-sm-6 col-md-6 col-lg-4 col-12"},ge={key:1},be={__name:"Profile",setup(d){const n=W(),{profile:t,errors:r,menus:c,uploadImage:I}=D(n),u=v(!0),p=v(null);F(()=>{n.getProfile()});const l=()=>{u.value=!u.value,document.getElementById("profile-password").setAttribute("type",u.value?"password":"text")},_=async m=>{let o=m.target.files;o.length&&(o[0]&&o[0].type.includes("image")?(I.value=o[0],await J(()=>{n.updateProfileAvatar()})):(y("Произошла ошибка! Файл не является изображением!","error"),m.target.value=""))},$=m=>{let o=m.target;o.localName==="button"?o.previousElementSibling.click():(o.localName==="svg"||o.localName==="path")&&o.closest("button").previousElementSibling.click()},V=m=>{let o=c.value.findIndex(g=>g.id===m);c.value.splice(o,1)};return(m,o)=>{const g=L("font-awesome-icon");return i(),b(C,null,[f(U,{title:"Профиль"}),s("div",X,[s("div",Y,[s("div",Z,[s("div",ee,[s("div",oe,[s("img",{src:e(t).image,id:"imgProfileImage",alt:"profile card"},null,8,se),s("input",{class:"d-none",accept:"image/*",type:"file",onChange:_},null,32),s("button",{class:"btn rounded-circle border bg-white d-flex p-075 position-absolute end-0 bottom-0 text-dark",onClick:$},te)]),s("div",le,[s("div",re,[ne,s("div",ie,[s("div",de,[s("div",ce,[f(P,{errors:e(h).call(e(r),"name")?e(r).name:[],placeholder:"Ваше Ф.И.О",modelValue:e(t).name,"onUpdate:modelValue":o[0]||(o[0]=a=>e(t).name=a),groupTextIconLeft:"fa-solid fa-user"},null,8,["errors","modelValue"]),f(P,{errors:e(h).call(e(r),"phone")?e(r).phone:[],placeholder:"Номер телефона",modelValue:e(t).phone,"onUpdate:modelValue":o[1]||(o[1]=a=>e(t).phone=a),groupTextIconLeft:"fa-solid fa-phone",mask:"+7 (###) ###-##-##"},null,8,["errors","modelValue"]),f(H,{formAddress:e(t).address,"onUpdate:formAddress":o[2]||(o[2]=a=>e(t).address=a),errors:e(h).call(e(r),"addresses")?e(r).addresses:[]},null,8,["formAddress","errors"]),e(t).isSpecialist?(i(),w(z,{key:0,errors:e(h).call(e(r),"description")?e(r).description:[],placeholder:"Описание",modelValue:e(t).description,"onUpdate:modelValue":o[3]||(o[3]=a=>e(t).description=a),textareaName:"description",textareaId:"profile-description",groupTextIconLeft:"fa-solid fa-comment"},null,8,["errors","modelValue"])):x("",!0),f(P,{errors:e(h).call(e(r),"password")?e(r).password:[],placeholder:"Пароль",modelValue:e(t).password,"onUpdate:modelValue":o[5]||(o[5]=a=>e(t).password=a),type:u.value?"password":"text","input-id":"profile-password",inputGroupClass:"password-control",groupTextIconLeft:"fa-solid fa-lock"},{groupTextIconRight:S(()=>[s("div",{class:"input-group-text cursor-pointer",onClick:o[4]||(o[4]=a=>l())},[u.value?(i(),w(g,{key:0,icon:"fa-solid fa-eye-slash fa-lg"})):x("",!0),u.value?x("",!0):(i(),w(g,{key:1,icon:"fa-solid fa-eye fa-lg"}))])]),_:1},8,["errors","modelValue","type"])]),s("button",{class:"btn btn-danger",type:"button",onClick:o[6]||(o[6]=a=>e(n).updateProfile())}," Сохранить ")])])]),e(t).isSpecialist?(i(),b("div",ue,[s("h2",pe,[s("button",me,[R(" Ваши меню "),s("button",{class:"btn btn-success position-absolute end-3rem",onClick:o[7]||(o[7]=a=>e(j).get(m.route("menu.create")))},[f(g,{icon:"fa-solid fa-plus"})])])]),s("div",fe,[s("div",_e,[e(c).length>0?(i(!0),b(C,{key:0},q(e(c),a=>(i(),b("div",ve,[f(T,{"special-id":p.value,"onUpdate:specialId":o[8]||(o[8]=E=>p.value=E),menu:a,onDeleteMenu:V},null,8,["special-id","menu"])]))),256)):(i(),b("p",ge,"У Вас пока нет добавленных меню"))])])])):x("",!0)])])])])]),p.value!==null?(i(),w(G,{key:0,id:"specialModal"},{body:S(()=>[f(T,{"in-modal":!0,"special-id":p.value,"onUpdate:specialId":o[9]||(o[9]=a=>p.value=a),menu:e(c)[e(c).map(a=>a.id).indexOf(p.value)],onDeleteMenu:V},null,8,["special-id","menu"])]),_:1})):x("",!0)],64)}}},we=M(be,[["__scopeId","data-v-4dc1b60c"]]);export{we as default};
